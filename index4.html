<script>
  async function populateGrid() {
    try {
      // 1) Fetch the JSON file as plain text
      const res = await fetch('links.json');
      if (!res.ok) {
        throw new Error('Failed to load links.json: HTTP ' + res.status);
      }
      const rawText = await res.text();

      // 2) Log the raw contents so you can inspect exactly what’s inside
      console.log('Raw links.json text:\n', rawText);

      // 3) Attempt to parse; wrap in try/catch to catch syntax errors
      let data;
      try {
        data = JSON.parse(rawText);
      } catch (parseErr) {
        console.error('JSON.parse failed at this raw text:', rawText);
        throw parseErr; // re‐throw so the outer catch displays the friendly message
      }

      // 4) Verify it’s an array
      if (!Array.isArray(data)) {
        console.error('Expected an array but got:', data);
        throw new Error('links.json is not a top-level array');
      }

      // 5) Build the grid normally
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      data.forEach(item => {
        const div = document.createElement('div');
        div.className = 'grid-item';

        const img = document.createElement('img');
        img.src = item.thumbnail;
        img.alt = item.alt || '';

        const link = document.createElement('a');
        link.href = item.url;
        link.target = '_blank';
        link.rel = 'noopener';
        link.appendChild(img);

        div.appendChild(link);
        grid.appendChild(div);
      });
    } catch (err) {
      console.error(err);
      document.getElementById('grid').innerHTML =
        '<p style="padding:1rem; text-align:center; color:#888;">Unable to load links.</p>';
    }
  }

  window.addEventListener('DOMContentLoaded', populateGrid);
</script>
